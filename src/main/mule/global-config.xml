<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:sftp="http://www.mulesoft.org/schema/mule/sftp"
	xmlns:ibm-mq="http://www.mulesoft.org/schema/mule/ibm-mq"
	xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
	xmlns:json-logger="http://www.mulesoft.org/schema/mule/json-logger" xmlns:tls="http://www.mulesoft.org/schema/mule/tls"
	xmlns:os="http://www.mulesoft.org/schema/mule/os"
	xmlns:anypoint-mq="http://www.mulesoft.org/schema/mule/anypoint-mq" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:apikit="http://www.mulesoft.org/schema/mule/mule-apikit" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:api-gateway="http://www.mulesoft.org/schema/mule/api-gateway" xmlns:secure-properties="http://www.mulesoft.org/schema/mule/secure-properties" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd 
http://www.mulesoft.org/schema/mule/mule-apikit http://www.mulesoft.org/schema/mule/mule-apikit/current/mule-apikit.xsd 
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/secure-properties http://www.mulesoft.org/schema/mule/secure-properties/current/mule-secure-properties.xsd
http://www.mulesoft.org/schema/mule/api-gateway http://www.mulesoft.org/schema/mule/api-gateway/current/mule-api-gateway.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/anypoint-mq http://www.mulesoft.org/schema/mule/anypoint-mq/current/mule-anypoint-mq.xsd
http://www.mulesoft.org/schema/mule/os http://www.mulesoft.org/schema/mule/os/current/mule-os.xsd
http://www.mulesoft.org/schema/mule/tls http://www.mulesoft.org/schema/mule/tls/current/mule-tls.xsd
http://www.mulesoft.org/schema/mule/json-logger http://www.mulesoft.org/schema/mule/json-logger/current/mule-json-logger.xsd
http://www.mulesoft.org/schema/mule/ibm-mq http://www.mulesoft.org/schema/mule/ibm-mq/current/mule-ibm-mq.xsd
http://www.mulesoft.org/schema/mule/sftp http://www.mulesoft.org/schema/mule/sftp/current/mule-sftp.xsd">
	<!-- <configuration-properties doc:name="Configuration properties" doc:id="25c05da0-330c-4801-8837-37d6c66ead2d" file="properties\local.yaml" /> -->
	 <apikit:config name="sgst-orders-edi-papi-config" api="sgst-orders-edi-papi.raml" outboundHeadersMapName="outboundHeaders" httpStatusVarName="httpStatus" />
	 <json-logger:config name="JSON_Logger_Config" doc:name="JSON Logger Config" doc:id="29f28a87-c074-400b-99ad-7d1396c443c8" environment="${mule.env}" />
	 <http:listener-config name="sgst-pp-edi-eapi-httpListenerConfig">
        <http:listener-connection host="${http.host}" port="${http.port}" readTimeout="${http.ReadTimeout}" protocol="HTTPS">
			<tls:context >
				<tls:key-store type="jks" path="${http.keystore.path}" alias="${http.keystore.alias}" keyPassword="${http.keystore.password}" password="${http.keystore.password}"/>
			</tls:context>
		</http:listener-connection>
    </http:listener-config>
	<!-- <api-gateway:autodiscovery apiId="${api.autodiscovery.id}" ignoreBasePath="true" doc:name="API Autodiscovery" doc:id="bc5f4b4c-7303-4988-9784-4190dd3eae28" flowRef="sgst-pp-rationalization-edi-eapi-main" /> -->
	<configuration-properties doc:name="Configuration properties" doc:id="057932e3-90cf-4dec-86a0-627e71a0055d" file="properties/${mule.env}.yaml" />
	<secure-properties:config name="Secure_Properties_Config" doc:name="Secure Properties Config" doc:id="db4504d2-4231-4906-875a-1cbdd1f6fe3a" file="properties/${mule.env}.yaml" key="${secret.key}" />
	<configuration doc:name="Configuration" doc:id="de615457-ca54-4818-8f6e-2e1c8463ad76" defaultErrorHandler-ref="common-exception-handler" />
	<configuration-properties doc:name="Configuration properties" doc:id="4118f3bf-9aba-42c8-8468-fc9f23e459ff" file="properties\common.yaml" />
	<os:object-store name="Object_store" doc:name="Object store" doc:id="f3447a8a-42bf-409c-8b05-9cf22cb91903" />
	<os:object-store name="Object_Store_PAPVNTL1" doc:name="Object store" doc:id="84c499d0-aa83-4b6a-a8bd-bba93f9d0dc3" config-ref="ObjectStore_Config"/>
	<os:object-store name="Object_Store_PAPVNTL2" doc:name="Object store" doc:id="6c5ad9ae-4b15-42f1-b9cf-43e768aeae46" config-ref="ObjectStore_Config"/>
	<os:object-store name="Object_Store_PMPC" doc:name="Object store" doc:id="38c9e77c-c3f3-481a-add9-60256553c43a" config-ref="ObjectStore_Config"/>
	<http:request-config name="HTTP_Request_For_BackUPFile" doc:name="HTTP Request configuration" doc:id="f711df78-437d-4248-aaf9-0e42599fc9f9" basePath="${http.utilities.papi.basepath}">
		<http:request-connection host="${http.utilities.papi.host}" maxConnections="${http.pcs.max.connections}" connectionIdleTimeout="${http.pcs.connections.idle.timeout}" responseBufferSize="${http.pcs.response.buffer.size}" protocol="HTTPS">
			<reconnection >
				<reconnect frequency="${http.pcs.reconnection.frequency}" count="${http.pcs.reconnection.count}" />
			</reconnection>
			<tls:context >
				<tls:trust-store insecure="true" />
			</tls:context>
			<http:client-socket-properties >
				<sockets:tcp-client-socket-properties connectionTimeout="${http.pcs.connections.timeout}" />
			</http:client-socket-properties>
		</http:request-connection>
	</http:request-config>
	<http:request-config name="PAPVNTL1_HTTP_Request_Configuration" doc:name="HTTP Request configuration" doc:id="23a46f5e-d02a-4740-9831-5bf8b14b51d2" basePath="${http.papvntl1.sapi.basepath}" >
		<http:request-connection protocol="HTTPS" host="${http.papvntl1.sapi.host}" maxConnections="${http.sapi.max.connections}" connectionIdleTimeout="${http.sapi.connections.idle.timeout}" responseBufferSize="${http.sapi.response.buffer.size}" usePersistentConnections="false">
			<reconnection >
				<reconnect frequency="${http.sapi.reconnection.frequency}" count="${http.sapi.reconnection.count}" />
			</reconnection>
			<tls:context >
				<tls:trust-store insecure="true" />
			</tls:context>
		</http:request-connection>
	</http:request-config>
	<http:request-config name="PAPVNTL2_HTTP_Request_Configuration" doc:name="HTTP Request configuration" doc:id="9e6e0ff3-99a6-4eb5-a7fb-910cbf86c42c" basePath="${http.papvntl2.sapi.basepath}" >
		<http:request-connection protocol="HTTPS" host="${http.papvntl2.sapi.host}" maxConnections="${http.sapi.max.connections}" connectionIdleTimeout="${http.sapi.connections.idle.timeout}" responseBufferSize="${http.sapi.response.buffer.size}" usePersistentConnections="false">
			<reconnection >
				<reconnect frequency="${http.sapi.reconnection.frequency}" count="${http.sapi.reconnection.count}" />
			</reconnection>
			<tls:context >
				<tls:trust-store insecure="true" />
			</tls:context>
		</http:request-connection>
	</http:request-config>
	<http:request-config name="PMPC_HTTP_Request_Configuration" doc:name="HTTP Request configuration" doc:id="d3e14dce-c5ae-489e-a427-740437cece86" basePath="${http.pmpc.sapi.basepath}" >
		<http:request-connection protocol="HTTPS" host="${http.pmpc.sapi.host}" maxConnections="${http.sapi.max.connections}" connectionIdleTimeout="${http.sapi.connections.idle.timeout}" responseBufferSize="${http.sapi.response.buffer.size}" usePersistentConnections="false">
			<reconnection >
				<reconnect frequency="${http.sapi.reconnection.frequency}" count="${http.sapi.reconnection.count}" />
			</reconnection>
			<tls:context >
				<tls:trust-store insecure="true" />
			</tls:context>
		</http:request-connection>
	</http:request-config>
	<http:request-config name="HTTP_EDIFILE_SAP_Request_Configuration" doc:name="HTTP Request configuration" doc:id="1d45d672-60b2-4ad2-a86a-f2fc93b20efb" basePath="${http.edifile.sapi.basepath}" >
		<http:request-connection protocol="HTTPS" host="${http.edifile.sapi.host}" maxConnections="${http.sapi.max.connections}" connectionIdleTimeout="${http.sapi.connections.idle.timeout}" responseBufferSize="${http.sapi.response.buffer.size}" usePersistentConnections="false">
			<reconnection >
				<reconnect frequency="${http.sapi.reconnection.frequency}" count="${http.sapi.reconnection.count}" />
			</reconnection>
			<tls:context >
				<tls:trust-store insecure="true" />
			</tls:context>
		</http:request-connection>
	</http:request-config>
	<!-- <ibm-mq:config name="IBM_MQ_Config" doc:name="IBM MQ Config" doc:id="5e67567a-0f4d-477f-9d8d-c42fc7253608" >
		<ibm-mq:connection cssId="819" specification="JMS_1_1" targetClient="NO_JMS_COMPLIANT">
			<ibm-mq:connection-mode >
				<ibm-mq:client host="133.184.33.2" port="1434" queueManager="GW4_JP" channel="CS352.TO.GW4_JP" />
			</ibm-mq:connection-mode>
		</ibm-mq:connection>
	</ibm-mq:config> -->
		<ibm-mq:config name="IBM_MQ_Config-TL2-test" doc:name="IBM MQ Config" doc:id="42a00b91-99cf-4679-9e34-ef280d1a8b13" >
		<ibm-mq:connection cssId='819' specification="JMS_1_1" targetClient="NO_JMS_COMPLIANT">
			<ibm-mq:connection-mode >
				<ibm-mq:client host="10.181.168.223" port="1434" queueManager="VGW4_JP" channel="CS352.TO.VGW4_JP" />
			</ibm-mq:connection-mode>
		</ibm-mq:connection>
	</ibm-mq:config>
	<global-property doc:name="Global Property" doc:id="056c91d0-c766-4078-ad78-1c9374004e81" name="mule.env" value="sit" />
	<global-property doc:name="Global Property" doc:id="8ad20181-b8c1-47bb-9279-3a062c204a26" name="secret.key" value="PanasonicDev2022"/>
	<sftp:config name="SFTP_Config_Common_Storage" doc:name="SFTP Config" doc:id="cb10cd34-e469-4175-a39d-9eb3f69a45ad" >
		<sftp:connection host="${sftp.common.host}" port="${sftp.common.port}" username="${sftp.common.username}" password="${secure::sftp.common.password}"/>
	</sftp:config>
	<os:config name="ObjectStore_Config" doc:name="ObjectStore Config" doc:id="ec612321-e184-4323-ba58-d96b874697a4" />
	<error-handler name="common-exception-handler" doc:id="620168ea-5f75-4860-b6e0-5ffeaf5d7084" >
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="254b4aa3-f7dd-49ab-8917-36be80077c18" type="COMPRESSION:COULD_NOT_DECOMPRESS, COMPRESSION:INVALID_ARCHIVE, COMPRESSION:TOO_MANY_ENTRIES" >
			<flow-ref doc:name="global-config-propagate-error" doc:id="871c9151-febb-41d7-a0cf-81c2fc97968e" name="global-config-propagate-error"/>
			<async doc:name="Async" doc:id="4ea297b2-2212-44cc-bcf1-3abdc44899a1" >
				<flow-ref doc:name="global-config-email-notification" doc:id="54df945f-7c1e-44db-b470-afcdc4ee43d9" name="global-config-email-notification" />
			</async>
		
</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="155be3ff-bd5f-44a2-add6-1abcd54a302d" type="APIKIT:BAD_REQUEST">
			<flow-ref doc:name="global-config-propagate-error" doc:id="8efce2bf-daaa-4636-a285-089799baef43" name="global-config-propagate-error"/>
		
</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="cb4df447-c5bd-44c5-bfe3-669ec59f6c86" type="APIKIT:NOT_FOUND" >
			<flow-ref doc:name="global-config-propagate-error" doc:id="ad6624b2-233b-42e3-960d-ca8a96b14028" name="global-config-propagate-error"/>
		
</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="39803931-88e3-41a4-a535-45b9ff15bffe" type="APIKIT:METHOD_NOT_ALLOWED" >
			<flow-ref doc:name="global-config-propagate-error" doc:id="e25e61c8-7f11-4c4c-8af6-8adf552452e4" name="global-config-propagate-error"/>
		
</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="a68bd140-c93b-4efd-abb7-8ff09bd277ff" type="APIKIT:NOT_ACCEPTABLE" >
			<flow-ref doc:name="global-config-propagate-error" doc:id="74909a81-a580-4d27-baeb-862b634e2e2c" name="global-config-propagate-error"/>
		
</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="1fe49386-00fb-4033-9afb-2bed75294639" type="APIKIT:UNSUPPORTED_MEDIA_TYPE" >
			<flow-ref doc:name="global-config-propagate-error" doc:id="b07a9670-ba1d-4b11-b844-4c26c9a27bb6" name="global-config-propagate-error"/>
		
</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="503f234b-8223-4b3e-ab0b-f20a1b2475ee" type="APIKIT:NOT_IMPLEMENTED" >
			<flow-ref doc:name="global-config-propagate-error" doc:id="613e7f94-c319-447a-a92f-b05741e3d1c6" name="global-config-propagate-error"/>
		
</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="66e0daab-ba36-4710-8a9b-fae0c348706e" type="HTTP:BAD_REQUEST, HTTP:CLIENT_SECURITY, HTTP:CONNECTIVITY, HTTP:FORBIDDEN, HTTP:INTERNAL_SERVER_ERROR, HTTP:METHOD_NOT_ALLOWED, HTTP:NOT_ACCEPTABLE, HTTP:NOT_FOUND, HTTP:PARSING, HTTP:RETRY_EXHAUSTED, HTTP:SECURITY, HTTP:SERVICE_UNAVAILABLE, HTTP:TIMEOUT, HTTP:TOO_MANY_REQUESTS, HTTP:UNAUTHORIZED, HTTP:UNSUPPORTED_MEDIA_TYPE">
			<flow-ref doc:name="global-config-propagate-error" doc:id="923b47e8-7f1f-4c01-b9c5-bf24205a8f05" name="global-config-propagate-error"/>
		
</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="26034729-4091-4cd7-a646-cc79bd85098c" type="HTTP:BAD_GATEWAY">
			<flow-ref doc:name="global-config-propagate-error" doc:id="5d6ba3ad-89d2-4e7f-bf2e-50709938234b" name="global-config-propagate-error"/>
		
</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="276e3c58-4a42-441e-8287-79a36755e654" type="HTTP:GATEWAY_TIMEOUT">
			<flow-ref doc:name="global-config-propagate-error" doc:id="794495eb-8971-4051-b978-add358b8a3e7" name="global-config-propagate-error"/>
			<async doc:name="Async" doc:id="e6dda620-861f-4f24-9069-3598213e44a5" >
				<flow-ref doc:name="global-config-email-notification" doc:id="a049dc75-b74f-427d-baa0-b515936600f6" name="global-config-email-notification" />
			</async>
		
</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="f6cbd65f-e161-4ff0-8eff-17e9a16ae1e8" type="ANY">
			<flow-ref doc:name="global-config-propagate-error" doc:id="8ce30dd7-edcb-4aa2-bd96-c4f6b5e76f53" name="global-config-propagate-error"/>
			<async doc:name="Async" doc:id="13f00813-6776-4beb-b5e8-56d91dfe4277">
			<flow-ref doc:name="global-config-email-notification" doc:id="e4d7af15-a832-4899-9f5b-4f32556d79cb" name="global-config-email-notification" />
		</async>
		
</on-error-propagate>
	</error-handler>
	<sub-flow name="global-config-propagate-error" doc:id="15b2754d-de41-470f-aed4-a9df8a0646af" >
		<ee:transform doc:name="Frame Error Message" doc:id="471f47eb-3533-40ba-90ce-968b01af97cb">
				<ee:message>
				<ee:set-payload resource="dwl/errorResponse.dwl" />

				</ee:message>
			<ee:variables >
			</ee:variables>
			
</ee:transform>
		<json-logger:logger doc:name="Logger" doc:id="59e86344-48ca-4c80-84e1-530e9945954e" config-ref="JSON_Logger_Config" message='#["Exception occurred processing the transaction for correlation Id " ++ vars.TransactionID]' tracePoint="EXCEPTION" priority="ERROR">
		</json-logger:logger>
	
</sub-flow>
	<sub-flow name="global-config-email-notification" doc:id="7e1c05b9-ba9f-459f-b277-8ffa0696091e" >
		<ee:transform doc:name="Set Request" doc:id="b6719c45-129a-402a-9c4a-4dd234096f7c" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
var seperator = "/"
---
{
    "apiName": app.name default "",
    "correlationID": vars.TransactionID default "",
    "toAddress": Mule::p('notification.email.toaddress') default [],
    "fileName": vars.fileDetails.flatFileName default "NA",
    "filePath": ("/" ++ Mule::p('api.flowDirection')  ++ "/" ++ lower(vars.fileDetails.subsidiary) ++ "/" ++ lower(vars.fileDetails.externalSystem) ++ vars.sapiHttpPath  ++ "/" ++ lower(vars.fileDetails.flatFileName) ++ "." ++ vars.fileDetails.flatFileExtension) as String,
    "errorDetails":{
        "errorCode":payload.errorCode default "",
        "errorDesc":payload.errorMessage default ""
   }}
 ]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<http:request method="POST" doc:name="send-email-notification" doc:id="2f9d3c72-56fe-4e67-81c5-2f07bd34bd6d" config-ref="HTTP_Request_For_BackUPFile" path="${http.utilities.papi.path.notification}" outputMimeType="application/json">
			<http:headers ><![CDATA[#[output application/java
---
{

"X-Client-ID": Mule::p('http.utilities.papi.client_id'),
"X-Client-Secret": Mule::p('http.utilities.papi.client_secret')
}]]]></http:headers>
		</http:request>
	</sub-flow>
</mule>
